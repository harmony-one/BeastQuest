require("dotenv").config();
const { Harmony } = require("@harmony-js/core");
const { ChainID, ChainType } = require("@harmony-js/utils");
const { BN } = require("bn.js");
const hmy = new Harmony(process.env.TESTNET, {
  chainType: ChainType.Harmony,
  chainId: ChainID.HmyTestnet,
});
const contractAddr = process.env.SALE;
const contractJson = require("../build/contracts/BQSale.json");
let contract = hmy.contracts.createContract(contractJson.abi, contractAddr);
contract.wallet.addByPrivateKey(process.env.PRIVATE_KEY);
// const amount = '0x6D499EC6C63380000';
// const options1 = { gasPrice: '0x3B9ACA000' };
let options2 = { gasPrice: 1000000000, gasLimit: 6721900 };

const tokenIds = [
  new BN(
    "57896044672577994259987476321355412925146949520896376248340417528552178582016"
  ),
  new BN(
    "57896044672577994259987476321355412925146949520896376248340417528552178582272"
  ),
  new BN(
    "57896044672577994259987476321355412925146949520896376248340417528552178582528"
  ),
  new BN(
    "57896044672577994259987572102401290735144483321370868584568129820623313568000"
  ),
  new BN(
    "57896044672577994259987572102401290735144483321370868584568129820623313568256"
  ),
  new BN(
    "57896044672577994259987572102401290735144483321370868584568129820623313568512"
  ),
  new BN(
    "57896044672577994259987667883524596732471315445392772934638477223843212558592"
  ),
  new BN(
    "57896044672577994259987667883524596732471315445392772934638477223843212558848"
  ),
  new BN(
    "57896044672577994259987667883524596732471315445392772934638477223843212559104"
  ),
  new BN(
    "57896044672577995866925520580589391742262284520484632328776024782791365361920"
  ),
  new BN(
    "57896044672577995866925520580589391742262284520484632328776024782791365362176"
  ),
  new BN(
    "57896044672577995866925520580589391742262284520484632328776024782791365362432"
  ),
  new BN(
    "57896044672577995866925520580589391742262284520484632328776024782791365362688"
  ),
  new BN(
    "57896044672577995866925616361887535581945596729936176710103935340218150813952"
  ),
  new BN(
    "57896044672577995866925616361887535581945596729936176710103935340218150814208"
  ),
  new BN(
    "57896044672577995866925616361887535581945596729936176710103935340218150814464"
  ),
  new BN(
    "57896044672577995866925712143524293936723397921168799437683738618751742902528"
  ),
  new BN(
    "57896044672577995866925712143524293936723397921168799437683738618751742902784"
  ),
  new BN(
    "57896044672577995866925712143524293936723397921168799437683738618751742903040"
  ),
  new BN(
    "57896044672577999080801609098320887474282745915786195866238383316831412683008"
  ),
  new BN(
    "57896044672577999080801609098320887474282745915786195866238383316831412683264"
  ),
  new BN(
    "57896044672577999080801609098320887474282745915786195866238383316831412683520"
  ),
  new BN(
    "57896044672577999080801609098320887474282745915786195866238383316831412683776"
  ),
  new BN(
    "57896044672577999080801704879361056293509455876736455058588297628357016682752"
  ),
  new BN(
    "57896044672577999080801704879361056293509455876736455058588297628357016683008"
  ),
  new BN(
    "57896044672577999080801704879361056293509455876736455058588297628357016683264"
  ),
  new BN(
    "57896044672577999080801800660472230685448287341769363977918324322917662327040"
  ),
  new BN(
    "57896044672577999080801800660472230685448287341769363977918324322917662327296"
  ),
  new BN(
    "57896044672577999080801896441728984342043126714670218066132199521389348126976"
  ),
  new BN(
    "57896044672578003901615837656455696622713895309247884933833559270639261450496"
  ),
  new BN(
    "57896044672578003901615837656455696622713895309247884933833559270639261450752"
  ),
  new BN(
    "57896044672578003901615837656455696622713895309247884933833559270639261451008"
  ),
  new BN(
    "57896044672578003901615933437695680118919439653546304161906402901258449977600"
  ),
  new BN(
    "57896044672578003901615933437695680118919439653546304161906402901258449977856"
  ),
  new BN(
    "57896044672578003901616029219213620103279469684680824582529535709688178409728"
  ),
  new BN(
    "57896044672578007115491830393332923245053143177597736487616873406641666523392"
  ),
  new BN(
    "57896044672578007115491830393332923245053143177597736487616873406641666523648"
  ),
  new BN(
    "57896044672578007115491830393332923245053143177597736487616873406641666523904"
  ),
  new BN(
    "57896044672578007115491830393332923245053143177597736487616873406641666524160"
  ),
  new BN(
    "57896044672578007115491926174436247774682091863284824834114927877952207061248"
  ),
  new BN(
    "57896044672578007115491926174436247774682091863284824834114927877952207061504"
  ),
  new BN(
    "57896044672578007115491926174436247774682091863284824834114927877952207061760"
  ),
  new BN(
    "57896044672578007115491926174436247774682091863284824834114927877952207062016"
  ),
  new BN(
    "57896044672578007115492021955676231270887636207583244062187771508571395588352"
  ),
  new BN(
    "57896044672578007115492021955676231270887636207583244062187771508571395588608"
  ),
  new BN(
    "57896044672578008722429874652389566315162071949697141814431790472876911493376"
  ),
  new BN(
    "57896044672578008722429874652389566315162071949697141814431790472876911493632"
  ),
  new BN(
    "57896044672578008722429874652389566315162071949697141814431790472876911493888"
  ),
  new BN(
    "57896044672578008722429874652389566315162071949697141814431790472876911494144"
  ),
  new BN(
    "57896044672578008722429970433561755545964083199645292458955783084517919555840"
  ),
  new BN(
    "57896044672578008722429970433561755545964083199645292458955783084517919556096"
  ),
  new BN(
    "57896044672578008722429970433561755545964083199645292458955783084517919556352"
  ),
  new BN(
    "57896044672578008722429970433561755545964083199645292458955783084517919556608"
  ),
  new BN(
    "57896044672578008722430066214941966127977988102257688283527039612286712938752"
  ),
  new BN(
    "57896044672578008722430066214941966127977988102257688283527039612286712939008"
  ),
  new BN(
    "57896044672578013543244007429399285015329936378559919176145422358318185185536"
  ),
  new BN(
    "57896044672578013543244007429399285015329936378559919176145422358318185185792"
  ),
  new BN(
    "57896044672578013543244007429399285015329936378559919176145422358318185186048"
  ),
  new BN(
    "57896044672578013543244007429399285015329936378559919176145422358318185186304"
  ),
  new BN(
    "57896044672578013543244103210611437181527714505177701827814000833777910153472"
  ),
  new BN(
    "57896044672578013543244103210611437181527714505177701827814000833777910153728"
  ),
  new BN(
    "57896044672578013543244103210611437181527714505177701827814000833777910153984"
  ),
  new BN(
    "57896044672578013543244103210611437181527714505177701827814000833777910154240"
  ),
  new BN(
    "57896044672578013543244198992073357693949035610980684524136240958104615780608"
  ),
  new BN(
    "57896044672578013543244198992073357693949035610980684524136240958104615780864"
  ),
  new BN(
    "57896044672578019970996184465246921246803340801127003522021449871097069568256"
  ),
  new BN(
    "57896044672578019970996184465246921246803340801127003522021449871097069568512"
  ),
  new BN(
    "57896044672578019970996184465246921246803340801127003522021449871097069568768"
  ),
  new BN(
    "57896044672578019970996184465246921246803340801127003522021449871097069569024"
  ),
  new BN(
    "57896044672578019970996280246341682290276053727527742152702807371589313626368"
  ),
  new BN(
    "57896044672578019970996280246341682290276053727527742152702807371589313626624"
  ),
  new BN(
    "57896044672578019970996280246341682290276053727527742152702807371589313626880"
  ),
  new BN(
    "57896044672578019970996280246341682290276053727527742152702807371589313627136"
  ),
  new BN(
    "57896044672578019970996376027563825190322773573312932806157532313003717820672"
  ),
  new BN(
    "57896044672578019970996376027563825190322773573312932806157532313003717820928"
  ),
  new BN(
    "57896044672578021577934228724220426220041462353900180800422881800282229965056"
  ),
  new BN(
    "57896044672578021577934228724220426220041462353900180800422881800282229965312"
  ),
  new BN(
    "57896044672578021577934228724220426220041462353900180800422881800282229965568"
  ),
  new BN(
    "57896044672578021577934228724220426220041462353900180800422881800282229965824"
  ),
];

(async function() {
  // add sale contract minter role to nft contract
  const tokenJson = require("../build/contracts/BeastQuest.json");
  let tokenContract = hmy.contracts.createContract(
    tokenJson.abi,
    process.env.TOKEN
  );
  let res = await tokenContract.methods.addMinter(process.env.SALE).send(options2);
  console.log(res);

  // add tokenIds to sale contract
  res = await contract.methods.updateNonFungibleSupply(tokenIds).send(options2);
  console.log(res);

  // create lot 0
  const lotId = 0;
  const nonFungibleSupply = tokenIds;
  const fungibleAmount = 1;
  const price = 100;

  res = await contract.methods
    .createLot(lotId, nonFungibleSupply, fungibleAmount, price)
    .send(options2);
  console.log(res);

  // start sale
  res = await contract.methods.start().send(options2);
  console.log(res);

  process.exit(0);
})();

// (function () {
//   const hmy_ws = new Harmony(process.env.LOCALNET_WS, {
//     chainType: ChainType.Harmony,
//     chainId: ChainID.HmyTestnet,
//   });
//   const contract = hmy_ws.contracts.createContract(contractJson.abi, contractAddr);

//   contract.events.LotCreated()
//     .on("data", (event) => {
//       console.log(event);
//     })
//     .on("error", console.error);
// });

(async function() {
  // let res = await contract.methods._nonFungibleSupply(4).call(options2);
  let res = await contract.methods.lastDiscount().call(options2);
  console.log(res.toString());
  // console.log(res);
});
